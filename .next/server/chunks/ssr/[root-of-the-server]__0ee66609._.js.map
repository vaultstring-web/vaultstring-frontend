{"version":3,"sources":["../../../../../../../../Desktop/VaultString/Projects/vaultstring-frontend/node_modules/.pnpm/next%4016.0.8_react-dom%4019.2.0_react%4019.2.1__react%4019.2.1/node_modules/next/src/server/route-modules/app-page/module.compiled.js","../../../../../../../../Desktop/VaultString/Projects/vaultstring-frontend/node_modules/.pnpm/next%4016.0.8_react-dom%4019.2.0_react%4019.2.1__react%4019.2.1/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-runtime.ts","../../../../../../../../Desktop/VaultString/Projects/vaultstring-frontend/node_modules/.pnpm/next%4016.0.8_react-dom%4019.2.0_react%4019.2.1__react%4019.2.1/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react.ts","../../../../../../../../Desktop/VaultString/Projects/vaultstring-frontend/src/lib/api/api-client.ts","../../../../../../../../Desktop/VaultString/Projects/vaultstring-frontend/src/context/AuthContext.tsx"],"sourcesContent":["if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/app-page/module.js')\n} else {\n  if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n      }\n    }\n  } else {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n      }\n    }\n  }\n}\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxRuntime\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.React\n","const GATEWAY = process.env.NEXT_PUBLIC_GATEWAY_URL || '';\r\nconst API_BASE = GATEWAY ? `${GATEWAY.replace(/\\/$/, '')}/api/v1` : '';\r\n\r\nconst TOKEN_KEY = 'kyd_access_token';\r\nconst USER_KEY = 'kyd_user_profile';\r\nexport function isAuthenticated() { return !!getToken(); }\r\n\r\nexport function getToken() {\r\n  if (typeof window === 'undefined') return null;\r\n  return localStorage.getItem(TOKEN_KEY);\r\n}\r\n\r\nexport function setToken(token: string | null) {\r\n  if (typeof window === 'undefined') return;\r\n  if (!token) localStorage.removeItem(TOKEN_KEY); else localStorage.setItem(TOKEN_KEY, token);\r\n}\r\n\r\nexport function getUser() {\r\n  if (typeof window === 'undefined') return null;\r\n  const raw = localStorage.getItem(USER_KEY);\r\n  if (!raw) return null;\r\n  try {\r\n    return JSON.parse(raw);\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport function setUser(user: any | null) {\r\n  if (typeof window === 'undefined') return;\r\n  if (!user) localStorage.removeItem(USER_KEY); else localStorage.setItem(USER_KEY, JSON.stringify(user));\r\n}\r\n\r\nexport async function apiFetch(path: string, init: RequestInit = {}) {\r\n  const url = API_BASE ? `${API_BASE.replace(/\\/$/, '')}${path.startsWith('/') ? path : '/' + path}` : path;\r\n\r\n  const headers: Record<string, string> = {\r\n    'Content-Type': 'application/json',\r\n    ...(init.headers as Record<string, string> || {})\r\n  };\r\n\r\n  const token = getToken();\r\n  const openAuthPaths = [\r\n    '/auth/login',\r\n    '/auth/register',\r\n    '/auth/password/reset',\r\n    '/auth/password/reset/confirm',\r\n    '/auth/verify',\r\n    '/auth/verify/resend',\r\n    '/auth/magic-link'\r\n  ];\r\n  const shouldAttachAuth = token && !headers['Authorization'] && !openAuthPaths.some(p => path.startsWith(p));\r\n  if (shouldAttachAuth) headers['Authorization'] = `Bearer ${token}`;\r\n\r\n  const method = String(init.method || 'GET').toUpperCase();\r\n  const unsafe = method === 'POST' || method === 'PUT' || method === 'PATCH' || method === 'DELETE';\r\n  const requiresIdempotency = unsafe && !openAuthPaths.some(p => path.startsWith(p));\r\n  if (requiresIdempotency && !headers['Idempotency-Key']) {\r\n    headers['Idempotency-Key'] = generateIdempotencyKey();\r\n  }\r\n\r\n  let res: Response;\r\n  let text = '';\r\n  try {\r\n    res = await fetch(url, { ...init, headers, credentials: 'include' });\r\n    text = await res.text();\r\n  } catch (_err) {\r\n    await delay(300);\r\n    res = await fetch(url, { ...init, headers, credentials: 'include' });\r\n    text = await res.text();\r\n  }\r\n  const contentType = res.headers.get('content-type') || '';\r\n  const isJson = contentType.toLowerCase().includes('application/json');\r\n  let data: any = null;\r\n  if (isJson && text) {\r\n    try {\r\n      data = JSON.parse(text);\r\n    } catch {\r\n      data = null;\r\n    }\r\n  }\r\n\r\n  if (!res.ok) {\r\n    const message = (data && (data.error || data.message)) || (text || res.statusText || 'API request failed');\r\n    const err: any = new Error(String(message));\r\n    err.status = res.status;\r\n    err.data = data ?? text ?? null;\r\n    throw err;\r\n  }\r\n\r\n  return data ?? (isJson ? null : (text || null));\r\n}\r\n\r\n// Small helper to simulate latency in mock mode\r\nexport function delay(ms = 500) {\r\n  return new Promise((r) => setTimeout(r, ms));\r\n}\r\n\r\nfunction generateIdempotencyKey() {\r\n  try {\r\n    if (typeof window !== 'undefined' && window.crypto && window.crypto.getRandomValues) {\r\n      const arr = new Uint8Array(16);\r\n      window.crypto.getRandomValues(arr);\r\n      return Array.from(arr, (b) => b.toString(16).padStart(2, '0')).join('');\r\n    }\r\n  } catch {}\r\n  return `web-${Date.now()}-${Math.random().toString(16).slice(2)}`;\r\n}\r\n\r\nexport default { apiFetch, delay, getToken, setToken, getUser, setUser };\r\n","'use client';\n\nimport { createContext, useContext, useEffect, useMemo, useState } from 'react';\nimport { getToken, getUser } from '@/src/lib/api/api-client';\nimport type { UserProfile } from '@/src/types/types';\n\ntype AuthContextValue = {\n  user: UserProfile | null;\n  setUser: (u: UserProfile | null) => void;\n};\n\nconst AuthContext = createContext<AuthContextValue>({ user: null, setUser: () => {} });\n\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\n  const [user, setUserState] = useState<UserProfile | null>(null);\n\n  useEffect(() => {\n    const token = getToken();\n    const raw = getUser();\n    if (token && raw) {\n      const name = raw?.first_name && raw?.last_name ? `${raw.first_name} ${raw.last_name}` : raw?.name || raw?.email || 'User';\n      const country = String(raw?.country_code || '').toUpperCase();\n      const type = String(raw?.user_type || '').toLowerCase();\n      let accountLabel = 'Personal Account';\n      if (country === 'MW' && type === 'individual') accountLabel = 'Sender (Malawi)';\n      else if (country === 'CN' && (type === 'merchant' || type === 'agent')) accountLabel = 'Receiver (China)';\n      else if (type === 'merchant') accountLabel = 'Business Account';\n      else if (type === 'agent') accountLabel = 'Agent Account';\n\n      const profile: UserProfile = {\n        name,\n        email: String(raw?.email || ''),\n        phone: String(raw?.phone || ''),\n        kycStatus: 'verified',\n        avatarUrl: '/icons/avatar-default.png',\n        accountLabel,\n        countryCode: country,\n        userType: type,\n      };\n      setUserState(profile);\n    }\n  }, []);\n\n  const value = useMemo<AuthContextValue>(() => ({\n    user,\n    setUser: (u) => {\n      setUserState(u);\n    },\n  }), [user]);\n\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\n}\n\nexport function useAuth() {\n  return useContext(AuthContext);\n}"],"names":["process","env","NEXT_RUNTIME","module","exports","require","__NEXT_EXPERIMENTAL_REACT","NODE_ENV","TURBOPACK","vendored","ReactJsxRuntime","React"],"mappings":"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","ignoreList":[0,1,2]}